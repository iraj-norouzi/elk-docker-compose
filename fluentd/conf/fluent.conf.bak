# fluentd/conf/fluent.conf
#<source>
#  @type forward
#  port 24224
#  bind 0.0.0.0
#</source>

<source>
  @type udp
  tag fortigate # required
  <parse>
    @type regexp
    expression /^\<(?<pri>[0-9]+)\>date=(?<date>[0-9]{4}-[0-9]{2}-[0-9]{2}) time=(?<time>[0-9]{2}:[0-9]{2}:[0-9]{2}) devname="(?<devname>[^ ]*)" devid="(?<devid>\w+)" logid="(?<logid>[0-9]+)" type="(?<recordtype>\w+)" subtype="(?<subtype>\w+)" level="(?<level>\w+)" vd="(?<vd>[a-z]+)" eventtime=(?<eventtime>[0-9]+) srcip=(?<srcip>[^ ]*) srcport=(?<srcport>[0-9]+) srcintf="(?<srcintf>\w+)" (.*?)$/
    #expression /^(\<(?<pri>[0-9]+)\>date=(?<date>[0-9]{4}-[0-9]{2}-[0-9]{2}) time=(?<time>[[0-9]{2}:[0-9]{2}:[0-9]{2}]) devname="(?<devname>[^ ]*)" devid="(?<devid>[a-zA-Z0-9]+)" logid="(?<logid>[0-9]+)" type="(?<fgttype>[-a-zA-Z]+)" subtype="(?<subtype>[a-zA-Z]+)" level="(?<level>[a-zA-Z]+)" vd="(?<vd>[a-z]+)" eventtime=(?<eventtime>[0-9]+) srcip=(?<srcip>[^ ]*) srcport=(?<srcport>[0-9]{1,5}) srcintf="(?<srcintf>[a-zA-Z0-9]+)" srcintfrole="(?<srcintfrole>[a-zA-Z]+)" dstip=(?<dstip>[^ ]*) dstport=(?<dstport>[0-9]{1,5}) dstintf="(?<dstintf>[a-zA-Z0-9]+)"\s+(poluuid="(?<poluuid>[^ ]*)")? dstintfrole="(?<dstintfrole>[a-zA-Z]+)" sessionid=(?<sessionid>[0-9]+) proto=(?<proto>[0-9]{1,2}) action="(?<action>[^ ]*)" policyid=(?<policyid>[0-9]+) policytype="(?<policytype>[^ ]*)" service="(?<service>[^ ]*)" dstcountry="(?<dstcountry>.*?)" srccountry="(?<srccountry>.*?)" trandisp="(?<trandisp>[a-z]*)" app="(?<app>[^ ]*)" duration=(?<duration>[0-9]+) sentbyte=(?<sentbyte>[0-9]+) rcvdbyte=(?<rcvdbyte>[0-9]+) sentpkt=(?<sentpkt>[0-9]+) appcat="(?<appcat>[^ ]*)"?)$/
    time_key time
    time_format %H:%M:%S
    types pri:integer,logid:integer,eventtime:time:unixtime
  </parse>
  port 5141               # optional. 5160 by default
  bind 0.0.0.0             # optional. 0.0.0.0 by default
  message_length_limit 1MB # optional. 4096 bytes by default
</source>

<match *.**>
  @type copy

  <store>
    @type elasticsearch
    host elasticsearch
    port 9200
    logstash_format true
    logstash_prefix fluentd
    include_tag_key true
    flush_interval 1s
  </store>

  <store>
    @type stdout
  </store>
</match>

